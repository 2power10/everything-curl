# 4. The source code

The source code is of course the actual engine parts of this project. After
all, it is a software project.

curl and libcurl are written in C.

## Hosting and download

You can always find the source code for the latest curl and libcurl release on
the [official curl web site](http://curl.haxx.se/). From there you can also
find alternative mirrors that host copies and there are checksums and digital
signatures provided to help you verify that what ends up on your local system
when you download these files are the same bytes in the same order as was
originally uploaded there by the curl team.

If you instead rather work directly with the curl source code off our source
code repository, you find all details in [the curl github
repo](https://github.com/bagder/curl/).

## Code layout

The curl source code tree is neither large nor complicated. A key thing to
remember is perhaps that libcurl is the library and that library is the
biggest component of the curl command line tool.

### root

We try to keep the number of files in the source tree root to a minimum. You
will see a slight difference in files if you check a release archive compared
to what is stored in the git repository as several files are generated by the
release scripts.

Some of the more notable ones include:

- `buildconf`: used to build configure and more when
  building curl from source off the git repository.
- `buildconf.bat`: the windows version of buildconf. Run this after having
  checked out the full source code from git.
- `CHANGES`: generated at release and put into the release archive. It
  contains the 1000 latest changes to the source repository.
- `configure`: a generated script that is used on unix-like systems to
  generate a setup when building curl.
- `COPYING`: the license detailing the rules for your using this code.
- `GIT-INFO`: only present in git and contains information about how to
  build curl after having checked out the code from git.
- `maketgz`: the script used to produce release archives, and daily snapshots
- `README`: a short summary of what curl and libcurl are.
- `RELEASE-NOTES`: contains the changes done for the latest release - and when
  found in git it contains the changes done since the previous release that
  are destined to end up in the coming release.

### lib

This directory contains the full source code for libcurl. It is the same
source code for all platforms. Over one hundred C source files and a few more
private header files. The header files used when building applications against
libcurl are not stored in this directory, see include/curl for those.

Depending on what features that are enabled in your own build and what
functions your platform provide, some of the source files or portions of the
source files may contain code that is not used in your particular build.

### lib/vtls

The VTLS sub section within libcurl is the home of all the TLS backends
libcurl can be built to support. The "virtual" TLS internal API is a common
API that is used within libcurl to access TLS and crypto functions without the
main code knowing exactly which TLS library that is used. This allows the
person who builds libcurl to select from a wide variety TLS libraries to build
with.

We also maintain a [SSL comparision
table](http://curl.haxx.se/docs/ssl-compared.html) on the web site to aid
users.

- OpenSSL: the by far most popular TLS library.
- BoringSSL: an OpenSSL fork maintained by Google. Will make libcurl disable a
  few features due to lacking functionality in the library.
- LibreSSL: an OpenSSL fork maintained by the OpenBSD team.
- NSS: a full-blown TLS library perhaps most known for being used by the
  Firefox web browser. This is the default TLS backend for curl on Fedora and
  Redhat systems.
- GnuTLS: a full-blown TLS library used by default by the debian packaged curl.
- mbedTLS: (formerly known as PolarSSL) is a TLS library perhaps more targeted
  towards an embedded market.
- WolfSSL: (formerly known as cyaSSL) is a TLS library perhaps more targeted
  towards an embedded market.
- axTLS: is a minuscule TLS library focused on a small footprint.
- scannel: the native TLS library on Windows.
- securetransport: the native TLS library on Mac OS X.
- gskit: the native TLS library on OS/400.

### src

This directory holds the source code for the curl command line tool. It is the
same source code for all platforms that run the tool.

Most of what the command line tool does is to convert given command line
options into the corresponding libcurl options or set of options and then make
sure to issue them correctly to drive the network transfer according to the
user's wishes.

This code uses libcurl just as any other application would.

### include/curl

Here are the public header files that are provided for libcurl-using
applications. Some of them are generated at configure or release time so they
do not look identical in the git repository as they do in a release archive.

With modern libcurl, all an application is expected to do in its C source code
is `#include <curl/curl.h>`

### docs

The main documentation location. Text files in this directory are typically
plain text files. We have slowly started to move towards Markdown format so a
few (but hopefully growing number of) files use the .md extension to signify
that.

Most of these documents are also shown on the curl web site automatically
converted from text to a web friendly format/look.

- `BINDINGS`: lists all known libcurl language bindings and where to find them
- `BUGS`: how to report bugs and where
- `CODE_OF_CONDUCT.md`: how we expect people to behave in this project
- `CONTRIBUTE`: what to think about when contributing to the project
- `curl.1`: the curl command line tool man page, in nroff format
- `curl-config.1`: the curl-config man page, in nroff format
- `FAQ`: frequently asked questions about various curl related subjects
- `FEATURES`: an incomplete list of curl features
- `HISTORY`: describes how the project started and has evolved over the years
- `HTTP2.md`: how to use HTTP/2 with curl and libcurl
- `HTTP-COOKIES`: how curl supports and works with HTTP cookies
- `index.html`: a basic html page as a documentation index page
- `INSTALL`: how to build and install curl and libcurl from source
- `INSTALL.cmake`: how to build curl and libcurl with cmake
- `INSTALL.devcpp`: how to build curl and libcurl with devcpp
- `INTERNALS`: details curl and libcurl internal structures
- `KNOWN_BUGS`: list of known bugs and problems
- `LICENSE-MIXING`: describes how to combine different third party modules and
  their individual licenses
- `MAIL-ETIQUETTE`: this is how to communicate on our mailing lists
- `MANUAL`: a tutorial-like guide on how to use curl
- `mk-ca-bundle.1`: the mk-ca-bundle tool man page, in nroff format
- `README.cmake`: cmake-specific details
- `README.netware`: netware-specific details
- `README.win32`: win32-specific details
- `RELEASE-PROCEDURE`: how to do a curl and libcurl release
- `RESOURCES`: further resources for further reading on what, why and how curl
  does things
- `ROADMAP.md`: what we want to work on in the future
- `SECURITY`: how we work on security
- `SSLCERTS`: TLS certificate handling documented
- `SSL-PROBLEMS`: common SSL problems and their causes
- `THANKS`: thanks to this extensive list of friendly people, curl exists today!
- `TheArtOfHttpScripting`: a tutorial into HTTP scripting with curl
- `TODO`: things we or you can work on implementing
- `VERSIONS`: how the version numbering of libcurl works

### docs/libcurl

All libcurl functions have their own man pages in individual files with .3
extensions - using nroff format, in this directory. The are also a few other
files that are described below.

- `ABI`
- `index.html`
- `libcurl.3`
- `libcurl-easy.3`
- `libcurl-errors.3`
- `libcurl.m4`
- `libcurl-multi.3`
- `libcurl-share.3`
- `libcurl-thread.3`
- `libcurl-tutorial.3`
- `symbols-in-versions`

### docs/libcurl/opts

This directory contains the man pages for the individual options for three
different libcurl functions.

`curl_easy_setopt()` options start with `CURLOPT_`,
`curl_mulit_setopt()` options start with `CURLMOPT_` and
`curl_easy_getinfo()` options start with `CURLINFO_`.

### docs/examples

Contains around 100 stand-alone examples that are meant to help readers
understand how libcurl can be used.

See also the [libcurl examples](libcurl-examples.md) section of this book.

### scripts

Handy scripts.

- `contributors.sh`: extracts contributors from the git repository since a
  given hash/tag. If `--releasenotes` is also used, it will add the existing
  names already mentioned in `RELEASE-NOTES`. The purpose is of course to get
  and maintain the list for the RELEASE-NOTES file and to allow manually added
  names to remain in there even on updates. The script uses the
  'THANKS-filter` file to rewrite some names.
- `contrithanks.sh`: extracts contributors from the git repository since a
  given hash/tag, filters out all the names that are already mentioned in
  `THANKS`, and then outputs `THANKS` to stdout with the list of new
  contributors appended at the end. Made to allow easier updates of the THANKS
  document.The script uses the 'THANKS-filter` file to rewrite some names.
- `log2changes.pl`: generates the `CHANGES` file for releases, as used by the
  release script. It simply converts git log output.
- `zsh.pl`: helper script to provide curl command line completions to users of
  the zsh shell.

## Handling different build options

The curl and libcurl source code have been carefully written to build and run
on virtually every computer platform in existence. This can only be done
through hard work and by adhering to a few guidelines (and of course a fair
amount of testing).

A golden rule is to always add #ifdefs that checks for specific features, and
then have the setup scripts (configure or cmake or hard-coded) check for the
presence of said features in a users computer setup before the program is
compiled there. Additionally and as a bonus thanks to this way of writing the
code, some features can be explicitly turned off even if they are present in
the system and *could* be used. Examples of that would be when users want to
for example build a version of the library with a smaller footprint or with
support for certain protocols disabled etc.

The project sometimes uses #ifdef protection around entire source files when
for example a single file is provided for a specific operating system or
perhaps for a specific feature that isn't always present. This, to make it
possible for all platforms to always build all files - it simplifies the build
scripts and makefiles a lot. A file entirely #ifdefed out hardly adds anything
to the build time anyway.

Rather than to sprinkle the code with #ifdefs and to the extent where it is
possible, we provide functions and macros that make the code look and work the
same, independent of present features. Some of those are then empty macros for
the builds that lack the features.

Both TLS handling and name resolving are handled with an internal API that
hides the specific implementation and choice of 3rd party software
library. That way, most of the internals work the same independently of which
TLS library or name resolve system libcurl is told to use.

## Style and code requirements

Source code that has a common style is easier to read than code that uses
different styles in different places. It helps making the code feel like one
continuing code base. Easy-to-read is a very important property of code and
helps making it easier to review when new things are added and it helps
debugging code when develoers are trying to figure out why things go wrong. A
unified style is more important than individual contributors having their own
personal tastes satisfied.

Our C code has a few style rules. Most of them are verified and upheld by the
lib/checksrc.pl script. Invoked with `make checksrc` or even by default by the
build system when built after `./configure --enable-debug` has been used.

It is normally not a problem for anyone to follow the guidelines, as you just
need to copy the style already used in the source code and there are no
particularly unusual rules in our book.

We also work hard on writing code that are warning-free on all the major
platforms and in general on as many platforms as possible. Code that obviously
will cause warnings is not be accepted as-is.

Some the rules that you won't be allowed to break are

### Indentation

We use only spaces for indentation, never TABs. We use two spaces for each new
open brace.

### Comments

Since we write C89 code, // aren't allowed. They weren't introduced in the C
standard until C99. We use only /* and */ comments:

    /* this is a comment */

### Long lines

Soure code in curl may never be wider than 80 columns and there are two
reasons for maintaining this even in the modern era of very large and high
resolution screens:

1. Narrower columns are easier to read than very wide ones. There's a reason
   newspapers haved used columns for decades or centuries.

2. Narrower columns allow developers to easier show multiple pieces of code
   next to each other in different windows. I often have two or three source
   code windows next to each other on the same srceen - as well as multiple
   terminal and debugging windows.

### open brace on the same line

In if/while/do/for expressions, we write the open brace on the same line as
the keyword and we then set the closing brace on the same indentation level as
the initial keyword. Like this:

    if(age < 40) {
      /* clearly a youngster */
    }

### else on the following line

When adding an `else` clause to a conditional expression using braces, we add
it on a new line after the closing brace. Like this:

    if(age < 40) {
      /* clearly a youngster */
    }
    else {
      /* probably intelligent */
    }

### No space before parens

When writing expressions using if/while/do/for, there shall be no space
between the keyword and the open parenthesis. Like this:

    while(1) {
      /* loop forever */
    }

## Contributing

TBD

### What to add

TBD

### What not to add

TBD

## git

TBD

### git commit style

TBD

## About adhering to standards and who's right

TBD

## Web site source code

TBD

### Building the web

TBD
